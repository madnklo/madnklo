include ../../Source/make_opts
SHELL = /bin/bash
LIBDIR = ../../lib/
PROG   = check
PROG_SPLITORDERS = check_sa_born_splitOrders
LINKLIBS =  -L../../lib/ -ldhelas -lmodel
LIBS = $(LIBDIR)libdhelas.$(libext) $(LIBDIR)libmodel.$(libext)
PROCESS=  matrix.o
# Import the DHELAS symbols too in the matrix_element.a library
# so that one does not have to link against libdhelas.a explicitly when using it
include ../../Source/DHELAS/aloha_file.inc
# Uncomment the line below to absorb DHELAS symbols directly in the matrix element library
#C_BINDINGS = $(PROCESS) C_bindings.o $(addprefix ../../Source/DHELAS/, $(ALOHARoutine) aloha_functions.o)
C_BINDINGS = $(PROCESS) C_bindings.o
CHECK_SA=  check_sa.o
CHECK_SA_SPLITORDERS=  check_sa_born_splitOrders.o
 
$(PROG): $(PROCESS) $(CHECK_SA) makefile $(LIBS)
	$(FC) $(FFLAGS) -o $(PROG) $(PROCESS) $(CHECK_SA) $(LINKLIBS)

$(PROG_SPLITORDERS): $(PROCESS) $(CHECK_SA_SPLITORDERS) makefile $(LIBS)
	$(FC) $(FFLAGS) -o $(PROG) $(PROCESS) $(CHECK_SA_SPLITORDERS) $(LINKLIBS)

driver.f: nexternal.inc pmass.inc ngraphs.inc coupl.inc

# Library for linking with C
ifeq ($(origin MENAME),undefined)
  MENAME=
endif
ifeq ($(origin MEDIR),undefined)
  MEDIR=
endif
$(MEDIR)libmatrix_element$(MENAME).$(libext): $(C_BINDINGS)
	$(call CREATELIB, $@, $^)

# Useful command to have make print-VARNAME printout the value of VARNAME in this makefile
print-%  : ; @echo $* = $($*)

clean:
	@rm -f *.o *.so *.mod *.$(libext) *.$(dylibext)

# For python linking (require f2py part of numpy)
ifeq ($(origin MENUM),undefined)
  MENUM=2
endif

matrix$(MENUM)py.so: matrix.f makefile $(LIBS)
	touch __init__.py
	$(F2PY) $(LINKLIBS) -c  matrix.f -m matrix$(MENUM)py
